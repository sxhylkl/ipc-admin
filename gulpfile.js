/** * Created by zzq on 2017/4/11. */// 引入各种组件var gulp                    = require('gulp'),                  //gulp        uglify                  = require('gulp-uglify'),           //js压缩        minifyCss               = require('gulp-minify-css'),       //css压缩        autoprefixer            = require('gulp-autoprefixer'),     //自动补全前缀        htmlmin                 = require('gulp-htmlmin'),          //压缩html        less                    = require('gulp-less'),             //less编译        imagemin                = require('gulp-imagemin'),         //图片压缩        imageminJpegRecompress  = require('imagemin-jpeg-recompress'),        imageminOptipng         = require('imagemin-optipng'),        browserSync             = require('browser-sync').create();  //浏览器自动刷新// 设置输入输出文件夹var devJs       = 'dev/script/*.js',                //js        resJs       = 'res/script',        devCss      = 'dev/css/*.css',                  //css        resCss      ='res/css',        devLess     = 'dev/css/*.less',                 //less        resLess     = 'res/css',        devImg      = 'dev/img/*.*',                    //img        resImg      = 'res/img',        devTplHtml  = 'dev/tpl/**/*.html',              //模板文件html        resTplHtml  = 'res/tpl',        devTplJs    = 'dev/tpl/**/*.js',                //控制器文件js        resTplJs    = 'res/tpl/',        devLib      = 'dev/lib/**/*.*',                 //引用框架*        resLib      = 'res/lib',    devJson     = 'dev/json/*.json',                //json迁移    resJson     = 'res/json';//task配置//js压缩,使用gulp jsmin启动gulp.task('jsmin',function(){    gulp.src(devJs)        .pipe(uglify({            mangle:false//阻止混淆关键词        }))        .pipe(gulp.dest(resJs));});//less编译gulp.task('less',function(){    gulp.src(devLess)        .pipe(less({            outputStyle:'compressed'        }))        .pipe(gulp.dest(resLess));});//css压缩gulp.task('minifyCss',function(){    gulp.src(devCss)        .pipe(minifyCss())        .pipe(gulp.dest(resCss))});//图片压缩任务，支持JPEG、PNG、及GIF文件;gulp.task('imgmin',function(){    var jpgmin = imageminJpegRecompress({            accurate:true,//高精度模式            quality:"high",//图像质量:low,medium,high and veryhigh            method:"smallfry",//网络优化:mpe,ssim,ms-min and smallfry            min:70,//最低质量            loops:0,//循环尝试次数，默认为6            progressive:false,//基线优化            subsmaple:"default"//子采样:default,disable        }),        pngmin = imageminOptipng({            optimizationLevel:4        });    gulp.src(devImg)        .pipe(imagemin({            use:[jpgmin,pngmin]        }))        .pipe(gulp.dest(resImg))});//模板文件（html和js压缩）gulp.task('tplmin',function(){    gulp.src(devTplHtml)        .pipe(htmlmin())        .pipe(gulp.dest(resTplHtml));    gulp.src(devTplJs)        .pipe(uglify({mangle:false}))        .pipe(gulp.dest(resTplJs));});//lib迁移gulp.task('copyLib',function(){    gulp.src(devLib)        .pipe(gulp.dest(resLib));});//json文件迁移gulp.task('copyJson',function(){    gulp.src(devJson)        .pipe(gulp.dest(resJson));})//服务器任务，以根目录为入口gulp.task('server',function(){    browserSync.init({        server:"./"    });});//监控改动并自动刷新gulp.task('auto',function(){    gulp.watch(devJs,['jsmin']);    gulp.watch(devLess,['less']);    gulp.watch(devCss,['minifyCss']);    gulp.watch(devTplHtml,['tplmin']);    gulp.watch(devTplJs,['tplmin']);    gulp.watch(devImg,['imgmin']);    gulp.watch(devLib,['copyLib']);    gulp.watch(devJson,['copyJson']);    gulp.watch(['res/**/*.*','*.html']).on('change',browserSync.reload);});gulp.task('default',['jsmin','less','minifyCss','imgmin','tplmin','copyLib','copyJson','server','auto']);